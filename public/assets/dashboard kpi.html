<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Survey Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <link rel="stylesheet" href="../css/main.css">
  <link rel="stylesheet" href="../css/dashboard.css">

</head>

<body>


  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="../index.html">
      <img src="../img/Generac_Logo_COLOR_2020 (2).png" width="150" height="40" alt="">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item active">
          <a class="nav-link" href="../index.html">Home</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="controller_customer_survey.html">Surveys</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="projects.html">Projects</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="responses.html">Responses</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="dashboard.html">Dashboard</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="add_data.html">Add data</a>
        </li>
      </ul>
    </div>
    <button id="logout-button"
      style="display: none; background-color: transparent; border: none; font-size: 150%; width: 4%; color: black;"><i
        class='bx bx-log-out'></i></button>
  </nav>

  <div class="card" style="min-height: 200vh;">
    <div class="card-header">
      <ul class="nav nav-tabs card-header-tabs">
        <li class="nav-item">
          <a class="nav-link" href="dashboard.html">Surveys</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="dashboard kpi.html">KPIs</a>
        </li>
      </ul>
    </div>

    <div class="container">
      <div class="header">
        <h1>MTC KPIs Dashboard</h1>
      </div>


      <!-- <div class="filters">
        <div style="margin-bottom: 0%;">
          <input type="date" id="start-date" placeholder="Start Date">
          <p style="text-align: center; margin-bottom: 0%;">Start date</p>
        </div>
        <div style="margin-bottom: 0%;">
          <input type="date" id="end-date" placeholder="End Date">
          <p style="text-align: center; margin-bottom: 0%;">End date</p>
        </div>

      </div>
      <div style="text-align: center; margin-bottom: 20px">
        <button class="btn" style="background-color: #e6e6e6; border: none; color: #919191;"
          id="clear-filters-btn">Clear Filters</button>
        <button class="btn btn-primary" onclick="filterData()">Apply Filter</button>
      </div> -->


      <div class="kpis">

        <div class="kpi">
          <i class='bx bxs-like' style="font-size: x-large;"></i>
          <h2 id="project-quality">0</h2>
          <p>Project Quality</p>
        </div>

        <div class="kpi">
          <i class='bx bxs-calendar' style="font-size: x-large;"></i>
          <h2 id="timely-comp">0%</h2>
          <p>Timely Completion</p>
        </div>

        <div class="kpi">
          <i class='bx bxs-time' style="font-size: x-large;"></i>
          <i class=''></i>
          <h2 id="resour">0%</h2>
          <p>Resource Utilization</p>
        </div>

        <div class="kpi">
          <i class='bx bxs-timer' style="font-size: x-large;"></i>
          <h2 id="efficiency">0%</h2>
          <p>Efficiency</p>
        </div>

        <div class="kpi">
          <h2 id="nps-score">0</h2>
          <div id="nps-icons" style="display: flex; justify-content: center; gap: 5px; margin-top: 10px;">
            <!-- Íconos de personas se llenarán dinámicamente -->
          </div>
          <p>Net Promoter Score (NPS)</p>
        </div>
      </div>


      <!-- Sección de gráficos nuevos -->
      <div class="charts" id="new-chart-container">

        <div class="chart-container">
          <div class="container">
            <div class="row align-items-center">
              <div class="col-md-9">
                <canvas id="project-quality-chart"></canvas>
              </div>
              <div class="col-md-3 grapgh-text">
                <p id="project-quality2">0%</p>
                <p id="projectQualityMsg" style="font-size: medium; font-weight: 500;">Texto</p>
              </div>
            </div>
          </div>
        </div>


        <div class="chart-container">
          <div class="container">
            <div class="row align-items-center">
              <div class="col-md-9">
                <canvas id="nps-chart"></canvas>
              </div>
              <div class="col-md-3 grapgh-text">
                <p id="nps-score2">0%</p>
                <p id="npsMsg" style="font-size: medium; font-weight: 500;">Texto</p>
              </div>
            </div>
          </div>
        </div>


        <div class="chart-container">
          <div class="container">
            <div class="row align-items-center">
              <div class="col-md-9">
                <canvas id="timely-completion-chart"></canvas>
              </div>
              <div class="col-md-3 grapgh-text">
                <p id="timely-completion">0%</p>
                <p id="timelyCompletionMsg" style="font-size: medium; font-weight: 500;">Texto</p>
              </div>
            </div>
          </div>
        </div>

        <div class="chart-container">
          <h5 style="font-weight: bold; color: #646464;;">Customer Satisfaction</h5>
          <h4 class="grapgh-text" id="customer-satisfaction" style="text-align: center;">0%</h4>
          <div id="stars" style="text-align: center;"></div>
          <br>
          <p id="satisfaction-goal" style="font-size: medium; font-weight: 500; text-align: center;"></p>
        </div>



        <div class="chart-container">
          <div class="container">
            <div class="row align-items-center">
              <div class="col-md-9">
                <canvas id="resource-utilization-chart"></canvas>
              </div>
              <div class="col-md-3 grapgh-text">
                <p id="resource-utilization-value">0%</p>
                <p id="resourceUtilizationMsg" style="font-size: medium; font-weight: 500;">Texto</p>
              </div>
            </div>
          </div>
        </div>


        <div class="chart-container">
          <div class="container">
            <div class="row align-items-center">
              <div class="col-md-9">
                <canvas id="client-retention-chart"></canvas>
              </div>
              <div class="col-md-3 grapgh-text">
                <p id="client-retention-value">0%</p>
                <p id="clientRetentionMsg" style="font-size: medium; font-weight: 500;">Texto</p>
              </div>
            </div>
          </div>
        </div>


        <div class="chart-container" style="display: none;">
          <div class="container">
            <div class="row align-items-center">
              <div class="col-md-9">
                <canvas id="value-add-chart"></canvas>
              </div>
              <div class="col-md-3 grapgh-text">
                <p id="value-add-value">0%</p>
                <p id="valueAddMsg" style="font-size: medium; font-weight: 500;">Texto</p>
              </div>
            </div>
          </div>
        </div>
      
<!-- Aqui iba la grafica de buget -->

      </div>

      <br>


      <div class="chart-container" >
        <div class="container" style="padding: 0%;">
          <div class="row align-items-center">
            <div class="col-md-6">
              <canvas id="budget-chart"></canvas>
            </div>
            
            <div class="col-md-6 grapgh-text" style="padding: 2%; margin-left: 0%;">
              <h5 style="font-weight: bold; font-size: 80%; margin-bottom: 2%;">Budget Overview</h5>
            
              <div class="row mb-3" style="margin-top: 5%;">
                <div class="col-6 d-flex align-items-center">
                  <p style="font-size: 50%; font-weight: 800; color: #646464;">Spending budget</p>
                </div>
                <div class="col-6 d-flex align-items-center justify-content-center" style="background-color: #f5f5f5; border-radius: 10px;">
                  <div class="text-center">
                    <div style="margin-top: 1%; margin-bottom: 1%;">
                      <p id="spending-budget-value" style="margin-bottom: 0%;"></p>
                    </div>
                  </div>
                </div>
              </div>
            
              <div class="row">
                <div class="col-6 d-flex align-items-center">
                  <p style="font-size: 50%; font-weight: 800; color: #646464;">Invoiced budget</p>
                </div>
                <div class="col-6 d-flex align-items-center justify-content-center" style="background-color: #f5f5f5; border-radius: 10px;">
                  <div class="text-center">
                    <div style="margin-top: 1%; margin-bottom: 1%;">
                      <p id="invoiced-budget-value" style="margin-bottom: 0%;"></p>
                  </div>
                  </div>
                </div>
              </div>
            </div>



            <div class="col-md-3 grapgh-text" style="display: none;">
              <h5 style="font-weight: bold; font-size: 60%; margin-bottom: 2%;">Budget Adherence and Accuracy</h5>
            
              <div class="row mb-3" style="margin-top: 5%;">
                <div class="col-6 d-flex align-items-center">
                  <p style="font-size: 50%; font-weight: 800; color: #646464;">Budget Adherence</p>
                </div>
                <div class="col-6 d-flex align-items-center justify-content-center" style="background-color: #f5f5f5; border-radius: 10px;">
                  <div class="text-center">
                    <div style="margin-top: 1%; margin-bottom: 1%;">
                      <p id="budget-adherence-value" style="margin-bottom: 0%;"></p>
                      <p id="budgetAdherenceMsg" style="font-size: medium; font-weight: 500; margin-bottom: 0%;">Texto</p>
                    </div>
                  </div>
                </div>
              </div>
            
              <div class="row">
                <div class="col-6 d-flex align-items-center">
                  <p style="font-size: 50%; font-weight: 800; color: #646464;">Budget Accuracy</p>
                </div>
                <div class="col-6 d-flex align-items-center justify-content-center" style="background-color: #f5f5f5; border-radius: 10px;">
                  <div class="text-center">
                    <div style="margin-top: 1%; margin-bottom: 1%;">
                      <p id="budget-accuracy-value" style="margin-bottom: 0%;"></p>
                      <p id="budgetAccuracyMsg" style="font-size: medium; font-weight: 500; margin-bottom: 0%;">Texto</p>
                  </div>
                  </div>
                </div>
              </div>
            </div>
            
            
          </div>
        </div>
      </div>


      
      <a href="#" class="export-btn" id="export-pdf">Export to PDF</a>
    </div>
  </div>

  
  </div>
  </div>



</body>



<!-- Firebase SDK-->
<script type="module">
  // Importar Firebase SDKs
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
  import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

  // Configuración de Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyAzYGVjjG0vOecXoH_gy3x03uIXSQb8-Do",
    authDomain: "mtc-surveys-platform.firebaseapp.com",
    projectId: "mtc-surveys-platform",
    storageBucket: "mtc-surveys-platform.appspot.com",
    messagingSenderId: "574347185932",
    appId: "1:574347185932:web:185bfbc030b6a02d494329",
    measurementId: "G-64XLLLDTBG"
  };

  // Inicializar Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // Verificar si el usuario está autenticado
  onAuthStateChanged(auth, (user) => {
    if (user) {
      // Usuario autenticado
      console.log("Usuario autenticado:", user);
      document.getElementById("logout-button").style.display = "block";  // Mostrar el botón de cierre de sesión
    } else {
      // No autenticado, redirigir al login
      console.log("Usuario no autenticado");
      window.location.href = '../assets/login.html';  // Redirigir a la página de login
    }
  });

  // Cerrar sesión
  document.getElementById("logout-button").addEventListener("click", () => {
    signOut(auth).then(() => {
      console.log("Sesión cerrada");
      window.location.href = '../assets/login.html';  // Redirigir al login después de cerrar sesión
    }).catch((error) => {
      console.error("Error al cerrar sesión:", error);
    });
  });
</script>

<script type="module">
  import { restrictAccess } from "../js/roleChecker.js";
  // Permitir solo roles "admin"
  restrictAccess(["admin"], "./error.html");
</script>
<script src="../js/dashboard_kpi.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
  integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"
  integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
  integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
</body>

</html>