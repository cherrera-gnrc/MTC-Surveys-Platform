<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mexico Technology Center Satisfaction Survey</title>
    <link href="https://cdn.jsdelivr.net/npm/@mdbootstrap/mdb/css/mdb.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="../css/customer_survey.css">
</head>
<body>

<!-- Navbar -->
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top">
        <a class="navbar-brand" href="../index.html">
            <img src="../img/Generac_Logo_COLOR_2020 (2).png" width="150" height="40" alt="">
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item active">
              <a class="nav-link" href="../index.html">Home</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="survey_intro.html">Surveys</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="projects.html">Projects</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="responses.html">Responses</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="dashboard.html">Dashboard</a>
            </li>
           
          </ul>
        </div>
        <button id="logout-button"  style="display: none; background-color: transparent; border: none; font-size: 150%; width: 5%;color: black;"><i class='bx bx-log-out'></i></button>
      </nav>

   
    <div class="fixed-buttons"> <button id="prev-response" class="btn btn-secondary"> <i class='bx bx-chevron-left' style="font-size: xx-large;"></i> </button> <button id="next-response" class="btn btn-secondary"> <i class='bx bx-chevron-right' style="font-size: xx-large;"></i> </button> </div>
    
    <div class="container">
        <h1>Anwswer for Mexico Technology Center Satisfaction Survey</h1>
        <p id="completionDate" name="completionDate"><!-- Date here --></p>
        <p id="timeDuration" name="timeDuration"><!-- Time here --></p>
    
        <hr>
        <div style="background-color: #f6f6f6; border-radius: 0.5rem; padding: 1%;">
            <p><b>Project Information</b></p>
            <p id="projectName"><!-- Name here --></p>
            <p id="projectDiscipline"><!-- Area here --></p>
            <p id="projectFinishDate"><!-- Finish date here --></p>
        </div>
        <form action="#" method="POST">
         
            <!-- Question 1 -->
            <div class="question">
                <label for="satisfaction">1. Overall Satisfaction. How satisfied are you with the overall service provided by the Mexico Technology Center?</label>
                <div class="btn-group">
                    <input type="radio" id="satisfaction5" name="satisfaction" value="Very Dissatisfied" onclick="updateProgress()">
                    <label for="satisfaction5">Very Dissatisfied</label>
                    <input type="radio" id="satisfaction4" name="satisfaction" value="Dissatisfied" onclick="updateProgress()">
                    <label for="satisfaction4">Dissatisfied</label>
                    <input type="radio" id="satisfaction3" name="satisfaction" value="Neutral" onclick="updateProgress()">
                    <label for="satisfaction3">Neutral</label>
                    <input type="radio" id="satisfaction2" name="satisfaction" value="Satisfied" onclick="updateProgress()">
                    <label for="satisfaction2">Satisfied</label>
                    <input type="radio" id="satisfaction1" name="satisfaction" value="Very Satisfied" onclick="updateProgress()">
                    <label for="satisfaction1">Very Satisfied</label>
                </div>
            </div>
    
            <!-- Question 2 -->
            <div class="question">
                <label for="workQuality">2. Quality of Work. How would you rate the quality of the work delivered?</label>
                <div class="btn-group">
                    <input type="radio" id="workQuality5" name="workQuality" value="Very Poor" onclick="updateProgress()">
                    <label for="workQuality5">Very Poor</label>
                    <input type="radio" id="workQuality4" name="workQuality" value="Poor" onclick="updateProgress()">
                    <label for="workQuality4">Poor</label>
                    <input type="radio" id="workQuality3" name="workQuality" value="Fair" onclick="updateProgress()">
                    <label for="workQuality3">Fair</label>
                    <input type="radio" id="workQuality2" name="workQuality" value="Good" onclick="updateProgress()">
                    <label for="workQuality2">Good</label>
                    <input type="radio" id="workQuality1" name="workQuality" value="Excellent" onclick="updateProgress()">
                    <label for="workQuality1">Excellent</label>
                </div>
            </div>
    
            <!-- Question 3 -->
            <div class="question">
                <label for="timeliness">3. Timeliness. How satisfied are you with the timeliness of project delivery?</label>
                <div class="btn-group">
                    <input type="radio" id="timeliness5" name="timeliness" value="Very Dissatisfied" onclick="updateProgress()">
                    <label for="timeliness5">Very Dissatisfied</label>
                    <input type="radio" id="timeliness4" name="timeliness" value="Dissatisfied" onclick="updateProgress()">
                    <label for="timeliness4">Dissatisfied</label>
                    <input type="radio" id="timeliness3" name="timeliness" value="Neutral" onclick="updateProgress()">
                    <label for="timeliness3">Neutral</label>
                    <input type="radio" id="timeliness2" name="timeliness" value="Satisfied" onclick="updateProgress()">
                    <label for="timeliness2">Satisfied</label>
                    <input type="radio" id="timeliness1" name="timeliness" value="Very Satisfied" onclick="updateProgress()">
                    <label for="timeliness1">Very Satisfied</label>
                </div>
            </div>
    
            <!-- Question 4 -->
            <div class="question">
                <label for="communication">4. Communication. How effective was communication throughout the project?</label>
                <div class="btn-group">
                    <input type="radio" id="communication5" name="communication" value="Very Ineffective" onclick="updateProgress()">
                    <label for="communication5">Very Ineffective</label>
                    <input type="radio" id="communication4" name="communication" value="Ineffective" onclick="updateProgress()">
                    <label for="communication4">Ineffective</label>
                    <input type="radio" id="communication3" name="communication" value="Neutral" onclick="updateProgress()">
                    <label for="communication3">Neutral</label>
                    <input type="radio" id="communication2" name="communication" value="Effective" onclick="updateProgress()">
                    <label for="communication2">Effective</label>
                    <input type="radio" id="communication1" name="communication" value="Very Effective" onclick="updateProgress()">
                    <label for="communication1">Very Effective</label>
                </div>
            </div>
    
            <!-- Question 5 -->
            <div class="question">
                <label for="responsiveness">5. Responsiveness. How would you rate the responsiveness to your requests and questions?</label>
                <div class="btn-group">
                    <input type="radio" id="responsiveness5" name="responsiveness" value="Very Poor" onclick="updateProgress()">
                    <label for="responsiveness5">Very Poor</label>
                    <input type="radio" id="responsiveness4" name="responsiveness" value="Poor" onclick="updateProgress()">
                    <label for="responsiveness4">Poor</label>
                    <input type="radio" id="responsiveness3" name="responsiveness" value="Fair" onclick="updateProgress()">
                    <label for="responsiveness3">Fair</label>
                    <input type="radio" id="responsiveness2" name="responsiveness" value="Good" onclick="updateProgress()">
                    <label for="responsiveness2">Good</label>
                    <input type="radio" id="responsiveness1" name="responsiveness" value="Excellent" onclick="updateProgress()">
                    <label for="responsiveness1">Excellent</label>
                </div>
            </div>
            <!-- Pregunta 6 -->
            <div class="question">
                <label for="technicalExpertise">6. Technical Expertise. How satisfied are you with the technical expertise of the team?</label>
                <div class="btn-group">
                    <input type="radio" id="technicalExpertise5" name="technicalExpertise" value="Very Dissatisfied" onclick="updateProgress()">
                    <label for="technicalExpertise5">Very Dissatisfied</label>
                    <input type="radio" id="technicalExpertise4" name="technicalExpertise" value="Dissatisfied" onclick="updateProgress()">
                    <label for="technicalExpertise4">Dissatisfied</label>
                    <input type="radio" id="technicalExpertise3" name="technicalExpertise" value="Neutral" onclick="updateProgress()">
                    <label for="technicalExpertise3">Neutral</label>
                    <input type="radio" id="technicalExpertise2" name="technicalExpertise" value="Satisfied" onclick="updateProgress()">
                    <label for="technicalExpertise2">Satisfied</label>
                    <input type="radio" id="technicalExpertise1" name="technicalExpertise" value="Very Satisfied" onclick="updateProgress()">
                    <label for="technicalExpertise1">Very Satisfied</label>
                </div>
            </div>
    
            <!-- Pregunta 7 -->
            <div class="question">
                <label for="problemSolving">7. Problem-solving. How well did the team handle any issues or challenges that arose during the project?</label>
                <div class="btn-group">
                    <input type="radio" id="problemSolving5" name="problemSolving" value="Very Poorly" onclick="updateProgress()">
                    <label for="problemSolving5">Very Poorly</label>
                    <input type="radio" id="problemSolving4" name="problemSolving" value="Poorly" onclick="updateProgress()">
                    <label for="problemSolving4">Poorly</label>
                    <input type="radio" id="problemSolving3" name="problemSolving" value="Neutral" onclick="updateProgress()">
                    <label for="problemSolving3">Neutral</label>
                    <input type="radio" id="problemSolving2" name="problemSolving" value="Well" onclick="updateProgress()">
                    <label for="problemSolving2">Well</label>
                    <input type="radio" id="problemSolving1" name="problemSolving" value="Very Well" onclick="updateProgress()">
                    <label for="problemSolving1">Very Well</label>
                </div>
            </div>
            <!-- Question 8 -->
            <div class="question">
                <label for="recommendation">8. Change Management. How satisfied are you with the management and communication of changes during the project?</label>
                <div class="btn-group">
                    <input type="radio" id="recommendation5" name="recommendation" value="Very Dissatisfied" onclick="updateProgress()">
                    <label for="recommendation5">Very Dissatisfied</label>
                    <input type="radio" id="recommendation4" name="recommendation" value="Dissatisfied" onclick="updateProgress()">
                    <label for="recommendation4">Dissatisfied</label>
                    <input type="radio" id="recommendation3" name="recommendation" value="Neutral" onclick="updateProgress()">
                    <label for="recommendation3">Neutral</label>
                    <input type="radio" id="recommendation2" name="recommendation" value="Satisfied" onclick="updateProgress()">
                    <label for="recommendation2">Satisfied</label>
                    <input type="radio" id="recommendation1" name="recommendation" value="Very Satisfied" onclick="updateProgress()">
                    <label for="recommendation1">Very Satisfied</label>
                </div>
            </div>
    
            <!-- Preguntas abiertas -->
            <!-- Pregunta 9 -->
            <div class="question">
                <label for="improvementSuggestions">9. Improvement Suggestions. What specific suggestions do you have for improving our services?</label>
                <textarea id="improvementSuggestions" name="improvementSuggestions" rows="3" class="form-control"></textarea>
            </div>
    
            <!-- Pregunta 10 -->
            <div class="question">
                <label for="openFeedback">10. Open Feedback. Any additional comments or feedback?</label>
                <textarea id="openFeedback" name="openFeedback" rows="3" class="form-control"></textarea>
            </div>
    
                <!-- Question 11 -->
            <div class="question">
                <label for="recommendationLikelihood1">11. Recommendation Likelihood. On a scale of 1 to 10, how likely are you to recommend the Mexico Technology Center’s services to others?</label>
                <div class="btn-group">
                    <input type="radio" id="recommendationLikelihood1" name="recommendationLikelihood" value="1" onclick="updateProgress()">
                    <label for="recommendationLikelihood1">1</label>
                    <input type="radio" id="recommendationLikelihood2" name="recommendationLikelihood" value="2" onclick="updateProgress()">
                    <label for="recommendationLikelihood2">2</label>
                    <input type="radio" id="recommendationLikelihood3" name="recommendationLikelihood" value="3" onclick="updateProgress()">
                    <label for="recommendationLikelihood3">3</label>
                    <input type="radio" id="recommendationLikelihood4" name="recommendationLikelihood" value="4" onclick="updateProgress()">
                    <label for="recommendationLikelihood4">4</label>
                    <input type="radio" id="recommendationLikelihood5" name="recommendationLikelihood" value="5" onclick="updateProgress()">
                    <label for="recommendationLikelihood5">5</label>
                    <input type="radio" id="recommendationLikelihood6" name="recommendationLikelihood" value="6" onclick="updateProgress()">
                    <label for="recommendationLikelihood6">6</label>
                    <input type="radio" id="recommendationLikelihood7" name="recommendationLikelihood" value="7" onclick="updateProgress()">
                    <label for="recommendationLikelihood7">7</label>
                    <input type="radio" id="recommendationLikelihood8" name="recommendationLikelihood" value="8" onclick="updateProgress()">
                    <label for="recommendationLikelihood8">8</label>
                    <input type="radio" id="recommendationLikelihood9" name="recommendationLikelihood" value="9" onclick="updateProgress()">
                    <label for="recommendationLikelihood9">9</label>
                    <input type="radio" id="recommendationLikelihood10" name="recommendationLikelihood" value="10" onclick="updateProgress()">
                    <label for="recommendationLikelihood10">10</label>
                </div>
            </div>

        </form>
    </div>



    <script>
        const API_URL = "https://getallcustomerresponses-dcwslcbviq-uc.a.run.app";
        let responses = [];
        let currentIndex = 0;

        async function fetchResponses() {
            try {
                const response = await fetch(API_URL);
                responses = await response.json();
                displayResponse(currentIndex);
            } catch (error) {
                console.error("Error fetching responses:", error);
            }
        }

        function displayResponse(index) {
    if (responses[index]) {
        const response = responses[index];

        // Llenar los datos del proyecto
        document.getElementById("projectName").textContent = `Name: ${response.name}`;
        document.getElementById("projectDiscipline").textContent = `MTC Area: ${response.discipline || "N/A"}`;
        document.getElementById("projectFinishDate").textContent = `Finish date: ${response.created_at}`;
        document.getElementById("completionDate").textContent = `Completion date: ${response.created_at}` ;
        document.getElementById("timeDuration").textContent = `Time duration: ${response.time_duration} mins`;



        // Rellenar las preguntas y bloquear la selección
        const questions = [
            { name: "satisfaction", value: response.q1 },
            { name: "workQuality", value: response.q2 },
            { name: "timeliness", value: response.q3 },
            { name: "communication", value: response.q4 },
            { name: "responsiveness", value: response.q5 },
            { name: "technicalExpertise", value: response.q6 },
            { name: "problemSolving", value: response.q7 },
            { name: "recommendation", value: response.q8 },
            { name: "recommendationLikelihood", value: response.q11 }
        ];

        questions.forEach(q => {
            const input = document.querySelector(`input[name="${q.name}"][value="${q.value}"]`);
            if (input) {
                input.checked = true;
            }
        });

        // Preguntas abiertas
        document.getElementById("improvementSuggestions").textContent = response.q9 || "No comment registered.";
        document.getElementById("openFeedback").textContent = response.q10 || "No comment registered.";

        // Bloquear las preguntas abiertas para que no se puedan editar
        document.getElementById("improvementSuggestions").readOnly = true;
        document.getElementById("openFeedback").readOnly = true;

        // Bloquear todas las opciones para que no se puedan cambiar
        const allInputs = document.querySelectorAll('input[type="radio"]');

        allInputs.forEach(input => {
            input.disabled = true;
        });
        } else {
            alert("No more responses.");
        }
    }


        document.getElementById("prev-response").addEventListener("click", () => {
            if (currentIndex > 0) {
                currentIndex--;
                displayResponse(currentIndex);
            }
        });

        document.getElementById("next-response").addEventListener("click", () => {
            if (currentIndex < responses.length - 1) {
                currentIndex++;
                displayResponse(currentIndex);
            }
        });

        // Llamar a fetchResponses al cargar la página
        window.onload = fetchResponses;
    </script>

<!--Firebase SDK-->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAzYGVjjG0vOecXoH_gy3x03uIXSQb8-Do",
        authDomain: "mtc-surveys-platform.firebaseapp.com",
        projectId: "mtc-surveys-platform",
        storageBucket: "mtc-surveys-platform.appspot.com",
        messagingSenderId: "574347185932",
        appId: "1:574347185932:web:185bfbc030b6a02d494329",
        measurementId: "G-64XLLLDTBG"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Función para aplicar restricciones de rol
    function applyRolePermissions(role) {
        const elementsToBlock = [
            { selector: ".nav-item a[href*='dashboard.html']", type: "navbar" },
            { selector: ".nav-item a[href*='responses.html']", type: "navbar" }
        ];

        elementsToBlock.forEach(({ selector, type }) => {
            const element = document.querySelector(selector);
            if (element) {
                if (role === "viewer") {
                    blockElement(element, type);
                }
            }
        });
    }

    // Función para bloquear elementos
    function blockElement(element, type) {
        if (type === "navbar") {
            // Bloquear enlaces de la barra de navegación
            element.style.pointerEvents = "none";
            element.style.color = "gray";
            element.innerHTML += ` <i class='bx bxs-lock-alt' style="margin-left: 5px;"></i>`;
        }
    }

    // Verificar autenticación y rol
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            console.log("Usuario autenticado:", user);
            document.getElementById("logout-button").style.display = "block";

            try {
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    console.log("Rol del usuario:", userData.role);
                    applyRolePermissions(userData.role);
                } else {
                    console.error("El documento del usuario no existe en Firestore.");
                }
            } catch (error) {
                console.error("Error al recuperar el rol del usuario:", error);
            }
        } else {
            console.log("Usuario no autenticado");
            window.location.href = '../assets/login.html';
        }
    });

    // Cerrar sesión
    document.getElementById("logout-button").addEventListener("click", () => {
        signOut(auth).then(() => {
            console.log("Sesión cerrada");
            window.location.href = '../assets/login.html';
        }).catch((error) => {
            console.error("Error al cerrar sesión:", error);
        });
    });
</script>




<script type="module">
  import { restrictAccess } from "../js/roleChecker.js";
  // Permitir solo roles "admin"
  restrictAccess(["admin"], "./error.html");
</script>

<script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
</body>
</html>
